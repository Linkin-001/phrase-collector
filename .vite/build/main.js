"use strict";const{app:l,BrowserWindow:c,globalShortcut:d,clipboard:m,ipcMain:n,Menu:r,dialog:g,shell:y}=require("electron"),s=require("path"),p=require(s.join(__dirname,"database")),{getSelectionText:h}=require("@xitanggg/node-selection");require("electron-squirrel-startup")&&l.quit();let t,a;const i=()=>{t=new c({width:1200,height:800,minWidth:800,minHeight:600,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:s.join(__dirname,"preload.js")},icon:s.join(__dirname,"../assets/icon.svg"),show:!1}),process.env.NODE_ENV,t.loadFile(s.join(__dirname,"../.vite/renderer/main_window/index.html")),t.once("ready-to-show",()=>{t.show()}),process.env.NODE_ENV==="development"&&t.webContents.openDevTools(),t.on("closed",()=>{l.quit()})},b=()=>{d.register("CommandOrControl+Q",async()=>{console.log("Ctrl+Q 快捷键被触发");try{const e=h();console.log("获取到的选中文本:",e),t.show(),t.focus(),e&&e.trim()?(console.log("发送快速捕获事件，文本:",e.trim()),t.webContents.send("quick-capture",{text:e.trim()})):(console.log("没有选中文本，发送空捕获事件"),t.webContents.send("quick-capture-empty"))}catch(e){console.error("快速捕获失败:",e),t.show(),t.focus(),t.webContents.send("quick-capture-empty")}})?console.log("全局快捷键 Ctrl+Q 注册成功"):console.error("全局快捷键 Ctrl+Q 注册失败")},w=()=>{const o=[{label:"文件",submenu:[{label:"新建短语",click:()=>{t.webContents.send("new-phrase")}},{label:"导出数据",click:()=>{t.webContents.send("export-data")}},{type:"separator"},{label:"退出",click:()=>{l.quit()}}]},{label:"编辑",submenu:[{label:"撤销",role:"undo"},{label:"重做",role:"redo"},{type:"separator"},{label:"剪切",role:"cut"},{label:"复制",role:"copy"},{label:"粘贴",role:"paste"}]},{label:"查看",submenu:[{label:"重新加载",role:"reload"},{label:"强制重新加载",role:"forceReload"},{label:"开发者工具",role:"toggleDevTools"},{type:"separator"},{label:"实际大小",role:"resetZoom"},{label:"放大",role:"zoomIn"},{label:"缩小",role:"zoomOut"},{type:"separator"},{label:"全屏",role:"togglefullscreen"}]},{label:"帮助",submenu:[{label:"关于",click:()=>{t.webContents.send("show-about")}}]}],e=r.buildFromTemplate(o);r.setApplicationMenu(e)};l.whenReady().then(async()=>{a=new p,await a.init(),i(),b(),w(),l.on("activate",()=>{c.getAllWindows().length===0&&i()})});l.on("window-all-closed",()=>{l.quit()});l.on("will-quit",()=>{d.unregisterAll()});n.handle("get-phrases",async(o,e={})=>await a.getPhrases(e));n.handle("add-phrase",async(o,e)=>await a.addPhrase(e));n.handle("update-phrase",async(o,e,u)=>await a.updatePhrase(e,u));n.handle("delete-phrase",async(o,e)=>await a.deletePhrase(e));n.handle("search-phrases",async(o,e)=>await a.searchPhrases(e));n.handle("get-phrase-stats",async()=>await a.getPhraseStats());n.handle("export-phrases",async(o,e)=>await a.exportPhrases(e));
